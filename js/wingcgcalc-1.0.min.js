function addPanel(){if(!$("#addPanelBtn").hasClass("disabled")){var c=$("#panelsqty");var b=strtoint(c.val())+1;if(b<=6){var a="#panel"+b.toString();$(a).show("fast");c.val(b);if(b==6){$("#addPanelBtn").addClass("disabled")}$("#removePanelBtn").removeClass("disabled")}else{alert("6 panels max")}}}function removePanel(){if(!$("#removePanelBtn").hasClass("disabled")){var c=$("#panelsqty");var b=strtoint(c.val())-1;if(b>=1){var a="#panel"+c.val();$(a).hide("fast");c.val(b);if(b==1){$("#removePanelBtn").addClass("disabled")}$("#addPanelBtn").removeClass("disabled")}else{alert("Minimim 1 panel")}}}function intRandom(a){return Math.floor(Math.random()*(a+1))}function draw_panel(a,d,e,c,b){a.beginPath();a.moveTo(0,0);a.lineTo(d,e);a.lineTo(d,e+b);a.lineTo(0,c);a.lineTo(0,0);a.closePath();a.stroke();a.fill()}function draw_cg(a,b,c,e){a.save();a.beginPath();if(e){a.strokeStyle="#3636b2";a.fillStyle="#3636b2";a.lineWidth=2/b}else{a.strokeStyle="#7070ff";a.fillStyle="#7070ff";a.lineWidth=1/b}a.moveTo(c.mac_x,c.le_mac_y);a.lineTo(c.mac_x,c.te_mac_y);a.stroke();a.beginPath();a.moveTo(0,c.cg_dist);a.lineTo(c.mac_x,c.cg_dist);a.stroke();var d=Math.max(1.5*panels[0].span/100,5);a.beginPath();a.arc(0,c.cg_dist,d,0,Math.PI*2,false);a.stroke();a.beginPath();a.arc(0,c.cg_dist,d,0,Math.PI*0.5,false);a.lineTo(0,c.cg_dist);a.fill();a.beginPath();a.arc(0,c.cg_dist,d,Math.PI*1,Math.PI*1.5,false);a.lineTo(0,c.cg_dist);a.fill();a.restore()}function strtofloat(b){var a=parseFloat(b);if(isNaN(a)){a=0}return a}function strtoint(b){var a=parseInt(b);if(isNaN(a)){a=0}return a}function load_panels(n){var e,c;if(!window.panels){window.panels=new Array()}window.panels[0]=new Array();window.panels[0].span=0;window.panels[0].root=0;window.panels[0].tipc=0;window.panels[0].sweep=0;window.panels[0].maxX=0;window.panels[0].minX=0;var k;for(e=1;e<=n;e++){c=e-1;window.panels[e]=new Array();k=window.panels[0].sweep;window.panels[e].span=strtofloat($("#panelspan"+e.toString()).val());window.panels[0].span+=panels[e].span;window.panels[e].root=strtofloat($("#chord"+c.toString()).val());window.panels[e].tipc=strtofloat($("#chord"+e.toString()).val());window.panels[e].sweep=strtofloat($("#sweep"+e.toString()).val());window.panels[0].sweep+=panels[e].sweep;window.panels[0].maxX=Math.max(window.panels[0].maxX,panels[e].root,panels[e].tipc+window.panels[0].sweep);window.panels[0].minX=Math.min(window.panels[0].minX,k,panels[0].sweep)}window.panels[0].root=panels[1].root;window.panels[0].tipc=panels[n].tipc;var b=strtofloat($("#cgpos").val());for(e=1;e<=n;e++){p=window.panels[e];if(p.span>0){window.panels[e].wingarea=(p.root+p.tipc)*p.span;var f=0;var g=(p.sweep-f)/p.span;var a=p.root;var d=((p.sweep+p.tipc)-a)/p.span;var l=-p.tipc;var o=((p.sweep+p.tipc+p.root)-l)/p.span;var h=p.root+p.tipc;var m=((p.sweep-p.root)-h)/p.span;window.panels[e].mac_x=(h-l)/(o-m);window.panels[e].le_mac_y=g*p.mac_x+f;window.panels[e].te_mac_y=d*p.mac_x+a;window.panels[e].cg_dist=p.le_mac_y+(p.te_mac_y-p.le_mac_y)*b/100;window.panels[e].maclen=p.te_mac_y-p.le_mac_y;window.panels[e].macdist=p.mac_x;$("#area").val(Math.round((p.wingarea/10000)*100)/100);$("#macdist").val(Math.round(p.macdist*100)/100);$("#maclen").val(Math.round(p.maclen*100)/100);$("#cgdist").val(Math.round(p.cg_dist*100)/100)}}window.panels[0].wingarea=0;window.panels[0].mac_x=0;window.panels[0].le_mac_y=0;window.panels[0].te_mac_y=0;window.panels[0].cg_dist=0;window.panels[0].maclen=0;window.panels[0].macdist=0;for(e=1;e<=n;e++){p=window.panels[e];if(p.wingarea>0){window.panels[0].wingarea+=p.wingarea;window.panels[0].mac_x+=p.mac_x*p.wingarea;window.panels[0].le_mac_y+=p.le_mac_y*p.wingarea;window.panels[0].te_mac_y+=p.te_mac_y*p.wingarea;window.panels[0].cg_dist+=p.cg_dist*p.wingarea;window.panels[0].maclen+=p.maclen*p.wingarea;window.panels[0].macdist+=p.macdist*p.wingarea}}window.panels[0].mac_x=window.panels[0].mac_x/window.panels[0].wingarea;window.panels[0].le_mac_y=window.panels[0].le_mac_y/window.panels[0].wingarea;window.panels[0].te_mac_y=window.panels[0].te_mac_y/window.panels[0].wingarea;window.panels[0].cg_dist=window.panels[0].cg_dist/window.panels[0].wingarea;window.panels[0].maclen=window.panels[0].maclen/window.panels[0].wingarea;window.panels[0].macdist=window.panels[0].macdist/window.panels[0].wingarea;$("#area").val(Math.round((window.panels[0].wingarea/10000)*100)/100);$("#macdist").val(Math.round(window.panels[0].macdist*100)/100);$("#maclen").val(Math.round(window.panels[0].maclen*100)/100);$("#cgdist").val(Math.round(window.panels[0].cg_dist*100)/100);return panels}function draw_wing(){var e=strtoint($("#panelsqty").val());var g=load_panels(e);var l=580;var f=300;var k=20;var b=document.getElementById("wingcanvas");if(b.getContext){var m=b.getContext("2d");var c;var a=g[0];var j=a.span;var d=Math.max(a.root,a.sweep+a.tipc,a.maxX-a.minX);if(j>d){canvas_w=l;zoom=(canvas_w-k*2)/j;canvas_h=Math.round(d*zoom)+k*2}else{canvas_h=f;zoom=(canvas_h-k*2)/d;canvas_w=Math.round(d*zoom)+k*2}b.setAttribute("width",canvas_w);b.setAttribute("height",canvas_h);m.strokeStyle="#000";m.fillStyle="#fff";m.lineWidth=1;m.strokeRect(0,0,canvas_w,canvas_h);m.save();m.translate(k,k);m.scale(zoom,zoom);m.lineWidth=2/zoom;m.strokeStyle="#000";m.translate(0,-a.minX);m.save();for(c=1;c<=e;c++){var a=g[c];if(a.span>0){draw_panel(m,a.span,a.sweep,a.root,a.tipc);if(a.cg_dist!=0){draw_cg(m,zoom,a,false)}m.translate(a.span,a.sweep)}}m.restore();draw_cg(m,zoom,g[0],true);m.restore()}};